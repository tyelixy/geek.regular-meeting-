# 11-15例会

## 隐写术

> 可以对将要隐写的信息以二进制形式写入图片



























## Raft算法

#### 1. 任期

> 用来标识从一个candidate出现到下一个candidate出现的时期

每个任期内理论上最多只有一个leader，也可能没有，进入下一个任期选举。

#### 2. 领导选举

当follower计时器归零时，会将自身任期+1并成为candidate，给自己投一票同时向其他服务器请求投票。

如果获得超过总数一半的投票，则可以成为leader。

1. 选举的完备性
   * 一个任期内只有一个leader，但是即使leader没有出现故障，如果有更高任期的candidate发起投票并获得超过半数的投票，该candidate即可成为新的leader。
   * 每个follower只有一张票。
   * 投票原则：
     * 任期限制：candidate必须有高过follower的任期号
     * 日志限制：candidate的日志不能少于follower
     * 任期优先
   * 选举超时原因：票数不足
   * 计时器是随机的，每个follower、每次的时间都不同。

问题：

_面对同任期的两个日志数不同的投票请求，是投给先发起投票的还是日志多的（如果都满足高任期并有足够多日志的要求）？_

_满足什么条件才会考虑日志？(如果任期高就可以同意投票，那还考虑日志数？如果同样的任期则不会同意投票，不需考虑日志数？）_

2. 日志同步

   1. leader接受客户端请求，添加到自己的状态机，向follower发起同步请求。

   2. follower接受leader的同步，添加到自己的状态机，并向leader发送成功响应。

   3. leader收到超过半数的成功响应，提交执行，并向follower发起同步请求，向客户端输出结果。
   4. follower收到leader同步，提交执行，向leader发送成功响应。

3. 当日志出现不一致

   leader总认为自己的日志是正确的，并同步修改不一致的日志。

   _只有超过半数被添加到状态机的请求会被leader提交，所以会被提交的请求一定在超过半数的机器中有日志。选举leader时，如果没有被提交的日志，则会有超过半数的机器不投票，则缺失被之前leader提交请求的日志的机器无法成为leader。_

#### 3. 集群成员变化

![image-20201115223941889](C:\Users\tang_xinyi\AppData\Roaming\Typora\typora-user-images\image-20201115223941889.png)

问题：

_集群配置信息当做特殊日志被同步，集群配置信息是任期中的日志吗？如果新机器仅有新的日志，而没有旧的日志，那它的信息不也是新的吗？如果选举，应该如何比较日志和任期呢？_

#### 4. 日志压缩



